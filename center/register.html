<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<title>注册</title>
<link rel="stylesheet" href="../static/layui/css/layui.css">
<link rel="stylesheet" href="../static/css/global.css">
<style type="text/css">
.container img {
	
}

.tab {
	margin: 2rem 0 1rem 0;
}

.tab-content {
	float: left;
	width: 50%;
	text-align: center;
	line-height: 2.5;
	background-color: #e2e1e4;
	height: 2.5rem;
	font-family: 微软雅黑;
	font-size: 1rem;
	font-weight: 100;
}

.mobile-tab {
	color: #ffffff;
}

.register-btn {
	display: flex;
	display: -webkit-flex; /* Safari */
	justify-content: center;
	align-items: center;
	margin: 0 auto;
	margin-top: 10rem;
	width: 80%;
	height: 2.5rem;
	background-color: #ca1d7b;
	text-align: center;
	border-radius: 10px;
}

.register-btn a {
	color: #fff;
}

.layui-form {
	padding-top: 10px;
}

.layui-form-item {
	background-color: #dadadf;
	height: 2.5rem;
	display: flex;
	align-items: center;
	margin-bottom: 10px;
}

.layui-input {
	background-color: #dadadf;
	font-size: .8rem;
	height: 2rem;
}

.already-send, .getcode {
	float: right;
	padding-left: .5rem;
}

.c-mid {
	display: inline-block;
	height: 100%;
	width: 1px;
	margin: 0 10px;
	vertical-align: middle;
	background-color: #000;
}
</style>
</head>
<body>
	<div class="container">
		<img class="bg-img" src="../static/img/register-back.jpg"> <img class="logo-img" src="../static/img/logo-2.png">
		<div class="tab">
			<div class="tab-content mobile-tab">手机号注册</div>
			<div class="tab-content mail-tab">邮箱注册</div>
		</div>
		<div class="layui-form layui-clear layui-form-pane">
			<form action="../center/register" class="form-content"></form>
		</div>
	</div>
	<script src="../static/js/rem.js"></script>
	<script src="../static/layui/layui.js"></script>
	<script>
	var typeInfo = sessionStorage.getItem("type");
	console.log(typeInfo);//获取type字段
	
    layui.config({
        version: "1"
    }).extend({'fly': '../static/layui/lay/modules/fly/cool'});
    
    layui.use(['layer', 'form','fly'], function () {
        var layer = layui.layer,form=layui.form,
            fly=layui.fly,$ = layui.jquery;
        var count = 60
        var timer;
        function showForm(type) {
            var mobilehtml = '<div class="layui-form-item">' +
                '                <label class="c-label">手机号:</label>' +
                '                <div class="c-div-input"><input type="text" name="username" required lay-verify="phone" autocomplete="off"  class="layui-input"> </div>' +
                '                <i class="c-mid"></i>' +
                '                <div class="getcode">获取验证码</div>' +
                '                <div class="already-send layui-hide">获取验证码</div>' +
                '            </div>'
            var mailhtml = '<div class="layui-form-item">' +
                '                <label class="c-label">邮箱:</label>' +
                '                <div class="c-div-input"><input type="text" name="username" lay-verify="email" autocomplete="off" lay-verify="email" class="layui-input"> </div>' +
                '                <i class="c-mid"></i>' +
                '                <div class="getcode">获取验证码</div>' +
                '                <div class="already-send layui-hide">获取验证码</div>' +
                '            </div>'
            var facthtml = type == 0?mobilehtml:mailhtml
            $('.form-content').html( facthtml+
                '            <div class="layui-form-item">' +
                '                <label class="c-label">验证码：</label>' +
                '                <div class="c-div-input"> <input type="text" name="captcha" autocomplete="off"  class="layui-input"> </div>' +
                '            </div>' +
                '            <div class="layui-form-item">' +
                '                <label class="c-label">密码：</label>' +
                '                <div class="c-div-input"> <input type="password" name="password" autocomplete="off"  class="layui-input"> </div>' +
                '            </div>' +
                '            <div class="layui-form-item">' +
                '                <label class="c-label">确认密码：</label>' +
                '                <div class="c-div-input"> <input type="password" name="repassword" autocomplete="off"  class="layui-input"> </div>' +
                '            </div>' +
                '            <input type="hidden" name="type" value="'+type+'">' +
                '            <div class="register-btn"><a lay-filter="reg-form" lay-submit href="javascript:;" >注册</a></div>')
            if(type == 0){
                $('.mobile-tab').css('background-color','#ca1d7b').siblings('.mail-tab').css('background-color','#e2e1e4')
            }else {
                $('.mail-tab').css('background-color','#ca1d7b').siblings('.mobile-tab').css('background-color','#e2e1e4')

            }
            $('.register-btn').on("touchstart",function () {
                $(this).css("background-color",'#a23872')
            })
            $('.register-btn').on("touchend",function () {
                $(this).css("background-color",'#ca1d7b')
                $(this).children('a').trigger('click')
            })
            $('.getcode').on('click',function () {
                var that = this;
                var al = $('.already-send')
                var username = $('input[name="username"]').val()
                if(!/^1\d{10}$/.test(username) && !/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(username) ){
                    layer.msg('邮箱/手机号格式不正确')
                    return false
                }
                var loadIndex = layer.load(1, {shade: 0.8});
                var data ={}
                if(type == 0){
                    data ={
                        type:type,
                        flag:0,
                        phone:username
                    }
                }else {
                    data ={
                        type:type,
                        flag:0,
                        email:username
                    }
                }
                fly.json('../center/captcha',data,function (res) {
                    layer.close(loadIndex);
                    $(that).addClass('layui-hide')
                    al.removeClass('layui-hide')
                    timer = setInterval(function () {
                        al.html('已发送'+count+'s')
                        if (count <= 0){
                            clearInterval(timer)
                            al.html('获取验证码')
                            count=60
                            $(that).removeClass('layui-hide')
                            al.addClass('layui-hide')
                            return
                        }
                        count--
                    },1000)
                    if(res.code == 0){
                        layer.msg('验证码已发送')
                    }else {
                        layer.msg(res.desc)
                    }
                },{
                    error:function () {
                        layer.close(loadIndex);
                    }
                })
            })
        }

        form.on('submit(reg-form)', function(data){
            console.log(data)
            var action = $(data.form).attr('action'), button = $(data.elem);
            if(data.field.password.trim().length < 6 || data.field.password.trim().length > 12){
                layer.msg('密码长度必须为6-12位')
                return false
            }
            if(data.field.password != data.field.repassword){
                layer.msg('密码不一致')
                return false
            }
            data.field.agentId = typeInfo||null;//将type字段传过去
            fly.json(action, data.field, function(res){
                if(res.code == 0){
                    layer.msg('注册成功')
                    setTimeout(function () {
                        location.href = 'reg-suc.html'
                    },500)
                }else {
                    layer.msg(res.desc)
                };
            });
            return false;
        });

        $('.mobile-tab').click(function () {
            clearInterval(timer)
            count=60
            showForm(0)
        })
        $('.mail-tab').click(function () {
            clearInterval(timer)
            count=60
            showForm(1)
        })

        showForm(0)

    })
</script>
</body>
</html>
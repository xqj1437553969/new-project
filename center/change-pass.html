<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<title>修改密码</title>
<link rel="stylesheet" href="../static/layui/css/layui.css">
<link rel="stylesheet" href="../static/css/global.css">
<style type="text/css">
body {
	
}

.container {
	padding-top: 3rem;
}

.layui-form {
	padding-top: 10px;
}

.layui-form-item {
	background-color: #dadadf;
	height: 2.5rem;
	display: flex;
	align-items: center;
	margin-bottom: 10px;
}

.layui-input {
	background-color: #dadadf;
	font-size: .8rem;
	height: 2rem;
}

.bottom-btn {
	margin-top: 60%;
}

.c-mid {
	display: inline-block;
	height: 100%;
	width: 1px;
	margin: 0 10px;
	vertical-align: middle;
	background-color: #000;
}
</style>
</head>
<body>
	<div class="container">
		<img class="bg-img" src="../static/img/register-back.jpg">
		<div class="layui-form layui-clear layui-form-pane">
			<form action="../center/updatePassword" class="form-content">
				<div class="layui-form-item">
					<label class="c-label">手机号/邮箱：</label>
					<div class="c-div-input">
						<input type="text" name="username" autocomplete="off" class="layui-input">
					</div>
				</div>
				<div class="layui-form-item">
					<label class="c-label">验证码：</label>
					<div class="c-div-input">
						<input type="text" name="captcha" autocomplete="off" class="layui-input">
					</div>
					<i class="c-mid"></i>
					<div class="getcode">获取验证码</div>
					<div class="already-send layui-hide">获取验证码</div>
				</div>
				<div class="layui-form-item">
					<label class="c-label">新密码：</label>
					<div class="c-div-input">
						<input type="password" name="password" autocomplete="off" class="layui-input">
					</div>
				</div>
				<div class="layui-form-item">
					<label class="c-label">确认新密码：</label>
					<div class="c-div-input">
						<input type="password" name="repassword" autocomplete="off" class="layui-input">
					</div>
				</div>
				<div class="bottom-btn">
					<a lay-filter="update-pass-form" lay-submit href="javascript:;">提交信息</a>
				</div>
			</form>
		</div>

	</div>

	<!-- 你的HTML代码 -->
	<script src="../static/js/rem.js"></script>
	<script src="../static/layui/layui.js"></script>
	<script>
    layui.config({
        version: "1"
    }).extend({'fly': '../static/layui/lay/modules/fly/cool'});
    layui.use(['layer','form', 'fly'], function () {
        var form = layui.form,
            fly = layui.fly, $ = layui.jquery,layer=layui.layer;

        $('.bottom-btn').on("touchstart",function () {
            $(this).css("background-color",'#a23872')
        })
        $('.bottom-btn').on("touchend",function () {
            $(this).css("background-color",'#ca1d7b')
            $(this).children('a').trigger('click')
        })
        var count = 60
        $('.getcode').on('click',function () {
            var that = this;
            var al = $('.already-send')
            var username = $('input[name="username"]').val()
            var isMobile,isMail;
            if(/^1\d{10}$/.test(username)){
                isMobile = true
            }else if(/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(username)){
                isMail = true
            }
            if(!isMobile && !isMail){
                layer.msg('手机号或邮箱有误');
                return
            }
            var loadIndex = layer.load(1, {shade: 0.8});
            var data ={}
            if(isMobile){
                data ={
                    type:0,
                    flag:1,
                    phone:username
                }
            }else {
                data ={
                    type:1,
                    flag:1,
                    email:username
                }
            }
            fly.json('../center/captcha',data,function (res) {
                layer.close(loadIndex);
                $(that).addClass('layui-hide')
                al.removeClass('layui-hide')
                var timer = setInterval(function () {
                    al.html('已发送'+count+'s')
                    if (count <= 0){
                        clearInterval(timer)
                        al.html('获取验证码')
                        count=30
                        $(that).removeClass('layui-hide')
                        al.addClass('layui-hide')
                        return
                    }
                    count--
                },1000)
                if(res.code == 0){
                    layer.msg('验证码已发送');
                    $('.getcode').html('已发送')
                    timer = setTimeout(function () {
                        $('.getcode').html('获取验证码')
                    },30000)
                }else {
                    layer.msg( res.desc);
                }
            },{
                error:function () {
                    layer.close(loadIndex);
                }
            })
        })

        form.on('submit(update-pass-form)', function (data) {
            var action = $(data.form).attr('action'), button = $(data.elem);
            if(data.field.password != data.field.repassword){
                layer.msg('密码不一致');
                return false
            }
            if(data.field.password.trim().length < 6 || data.field.password.trim().length > 12){
                layer.msg('密码长度必须为6-12位')
                return false
            }
            fly.json(action, data.field, function (res) {
                if (res.code == 0) {
                    layer.msg( '修改密码成功');
                    setTimeout(function () {
                        location.href='update-pass-suc.html'
                    },500)
                }  else {
                    layer.msg(res.desc);
                }
            });
            return false;
        });
    })
</script>
</body>
</html>